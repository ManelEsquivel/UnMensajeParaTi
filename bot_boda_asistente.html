<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Bot de Boda</title>
  <style>
    #chat-bubble {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #f7c6c7;
      color: white;
      font-size: 24px;
      padding: 12px;
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      z-index: 1000;
    }
    #chat-window {
      display: none;
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 300px;
      max-height: 400px;
      background-color: white;
      border: 2px solid #f7c6c7;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 1000;
      overflow: hidden;
      font-family: sans-serif;
    }
    #chat-header {
      background-color: #f7c6c7;
      color: white;
      padding: 10px;
      font-weight: bold;
      text-align: center;
    }
    #chat-body {
      padding: 10px;
      height: 250px;
      overflow-y: auto;
    }
    #chat-input {
      padding: 10px;
      border-top: 1px solid #eee;
      display: flex;
    }
    #user-question {
      flex: 1;
      padding: 5px;
    }
    #send-button {
      background-color: #f7c6c7;
      color: white;
      border: none;
      padding: 5px 10px;
      margin-left: 5px;
      border-radius: 5px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="chat-bubble" onclick="toggleChat()">üí¨</div>
  <div id="chat-window">
    <div id="chat-header">Bot de la Boda üíç</div>
    <div id="chat-body">
      <p>Hola, soy tu asistente para ayudarte con la boda de Manel y Carla üíï</p>
    </div>
    <div id="chat-input">
      <input type="text" id="user-question" placeholder="Escribe tu pregunta...">
      <button id="send-button" onclick="processQuestion()">Enviar</button>
    </div>
  </div>

  <script>
    const qa = {
      "¬øD√≥nde es la ceremonia?": "Masia Mas Llombart",
      "¬øA qu√© hora empieza la boda?": "A las 12:00 AM",
      "¬øD√≥nde es el banquete?": "Se har√° en el mismo recinto, ser√° interior.",
      "¬øHay c√≥digo de vestimenta?": "Preferiblemente formal, sin ser de etiqueta",
      "¬øHay opciones de alojamiento cerca?": "Si, hay varias opciones como por ejemplo: Villa Coliving Casa Rural, Celler Suites",
      "¬øC√≥mo llegar al lugar?": "Desde Barcelona Sants: R4 ‚Üí Fabra i Puig ‚Üí Estaci√≥ d'Autobusos (e21) ‚Üí Av. de Burgos - Parc de Can Mul√† (360)",
      "¬øHay estacionamiento disponible?": "S√≠, en el mismo recinto",
      "¬øQu√© tipo de comida se servir√°?": "Principalmente es comida mediterr√°nea",
      "¬øD√≥nde puedo confirmar mi asistencia?": "En https://www.bodas.net/web/manel-y-carla/confirmatuasistencia-3"
    };

    function toggleChat() {
      const chat = document.getElementById('chat-window');
      chat.style.display = chat.style.display === 'none' ? 'block' : 'none';
    }

    function normalize(text) {
      return text.toLowerCase()
        .normalize("NFD").replace(/\p{Diacritic}/gu, "")
        .replace(/[¬ø?¬°!.,]/g, "")
        .trim();
    }

    function getBestMatch(userInput) {
      const input = normalize(userInput);
      let bestMatch = null;
      let highestScore = 0;
      for (const question in qa) {
        const normQuestion = normalize(question);
        const score = similarity(input, normQuestion);
        if (score > highestScore) {
          highestScore = score;
          bestMatch = question;
        }
      }
      return highestScore > 0.5 ? qa[bestMatch] : "Lo siento, no tengo informaci√≥n sobre eso a√∫n.";
    }

    function similarity(a, b) {
      const longer = a.length > b.length ? a : b;
      const shorter = a.length > b.length ? b : a;
      const longerLength = longer.length;
      if (longerLength === 0) return 1.0;
      return (longerLength - editDistance(longer, shorter)) / longerLength;
    }

    function editDistance(s1, s2) {
      s1 = s1.toLowerCase();
      s2 = s2.toLowerCase();
      const costs = [];
      for (let i = 0; i <= s1.length; i++) {
        let lastValue = i;
        for (let j = 0; j <= s2.length; j++) {
          if (i === 0)
            costs[j] = j;
          else {
            if (j > 0) {
              let newValue = costs[j - 1];
              if (s1.charAt(i - 1) !== s2.charAt(j - 1))
                newValue = Math.min(Math.min(newValue, lastValue), costs[j]) + 1;
              costs[j - 1] = lastValue;
              lastValue = newValue;
            }
          }
        }
        if (i > 0)
          costs[s2.length] = lastValue;
      }
      return costs[s2.length];
    }

    function processQuestion() {
      const input = document.getElementById('user-question').value;
      const response = getBestMatch(input);
      const body = document.getElementById('chat-body');
      body.innerHTML += `<p><strong>T√∫:</strong> ${input}</p>`;
      body.innerHTML += `<p><strong>Bot:</strong> ${response}</p>`;
      document.getElementById('user-question').value = "";
      body.scrollTop = body.scrollHeight;
    }
  </script>
</body>
</html>

